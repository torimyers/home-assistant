---
# System Status Binary Sensors - Dune Monitoring Network
# Critical status indicators for system health and security

- name: "House Occupied"
  unique_id: "house_occupied"
  state: >-
    {% set motion_sensors = [
      'binary_sensor.office_motion',
      'binary_sensor.kitchen_motion', 
      'binary_sensor.living_room_motion',
      'binary_sensor.bedroom_motion',
      'binary_sensor.atlas_room_motion'
    ] %}
    {{ motion_sensors | select('is_state', 'on') | list | length > 0 }}
  icon: "mdi:home-account"
  device_class: occupancy

- name: "All Systems Operational"
  unique_id: "all_systems_operational"
  state: >-
    {% set critical_systems = [
      'sensor.sietch_health_score',
      'sensor.automation_success_rate',
      'sensor.energy_shield_status'
    ] %}
    {% set operational_count = 0 %}
    {% for sensor in critical_systems %}
      {% if states(sensor) | float(0) > 70 %}
        {% set operational_count = operational_count + 1 %}
      {% endif %}
    {% endfor %}
    {{ operational_count == critical_systems | length }}
  icon: "mdi:check-circle"
  device_class: safety

- name: "Critical Alert Status"
  unique_id: "critical_alert_status"
  state: >-
    {% set alert_sensors = [
      'sensor.sietch_health_score',
      'sensor.water_conservation_index',
      'sensor.energy_shield_status'
    ] %}
    {% for sensor in alert_sensors %}
      {% if states(sensor) | float(0) < 50 %}
        {{ true }}
        {% break %}
      {% endif %}
    {% else %}
      {{ false }}
    {% endfor %}
  icon: "mdi:alert-octagon"
  device_class: problem

- name: "Automation System Healthy"
  unique_id: "automation_system_healthy"
  state: >-
    {% set success_rate = states('sensor.automation_success_rate') | float(0) %}
    {{ success_rate > 85 }}
  icon: "mdi:robot"
  device_class: connectivity

- name: "Night Mode Active"
  unique_id: "night_mode_active" 
  state: >-
    {% set current_time = now().hour %}
    {{ current_time >= 22 or current_time <= 6 }}
  icon: "mdi:weather-night"