---
# Motion Pattern Anomaly Detection - Tribal Movement Intelligence
alias: "Motion Pattern Anomaly Detection"
description: "Advanced motion analytics with pattern efficiency monitoring and tribal movement insights"
trigger:
  - platform: template
    value_template: >-
      {{ state_attr('sensor.motion_pattern_analysis', 'efficiency_score').replace('% efficiency', '') | int < 60 }}
    for:
      minutes: 10
    id: pattern_inefficiency
  - platform: template
    value_template: >-
      {{ states('sensor.motion_pattern_analysis') == 'Full Activity' and
         states('sensor.system_response_time') | float < 70 }}
    for:
      minutes: 5
    id: overwhelming_activity_pattern
  - platform: template
    value_template: >-
      {{ states('sensor.motion_pattern_analysis') == 'Dormant' and
         (now().hour >= 8 and now().hour <= 20) }}
    for:
      minutes: 20
    id: unusual_dormancy_pattern
  - platform: template
    value_template: >-
      {{ states('sensor.fremen_activity_level') | float < 20 and
         (now().hour >= 10 and now().hour <= 16) }}
    for:
      minutes: 15
    id: midday_inactivity_anomaly
  - platform: template
    value_template: >-
      {{ state_attr('sensor.motion_pattern_analysis', 'pattern_type') == 'Multi-Zone' and
         states('sensor.harvester_efficiency') | float < 75 }}
    id: multi_zone_inefficiency
  - platform: template
    value_template: >-
      {{ states('sensor.sietch_occupancy_distribution') == 'No Primary Zone' and
         states('sensor.fremen_activity_level') | float > 30 }}
    for:
      minutes: 8
    id: phantom_activity_pattern
  - platform: template
    value_template: >-
      {{ state_attr('sensor.motion_pattern_analysis', 'efficiency_score').replace('% efficiency', '') | int >= 95 }}
    for:
      minutes: 15
    id: perfect_motion_efficiency
  - platform: template
    value_template: >-
      {{ states('sensor.fremen_activity_level') | float >= 90 and
         states('sensor.water_conservation_index') | float >= 85 }}
    for:
      minutes: 10
    id: optimal_activity_conservation_balance
condition:
  - condition: state
    entity_id: input_boolean.notification_system_enabled
    state: "on"
action:
  - choose:
      # PATTERN INEFFICIENCY ALERT
      - conditions:
          - condition: trigger
            id: pattern_inefficiency
        sequence:
          - service: notify.mobile_app_toris_iphone
            data:
              title: "‚ö° Motion Pattern Inefficiency Detected"
              message: >-
                Movement patterns show suboptimal efficiency, Muad'Dib. The tribe moves without purpose.
                
                ‚ö° **Pattern Efficiency**: {{ state_attr('sensor.motion_pattern_analysis', 'efficiency_score') }}
                üèÉ **Movement Status**: {{ states('sensor.motion_pattern_analysis') }} - {{ state_attr('sensor.motion_pattern_analysis', 'pattern_type') }}
                
                **Current Movement Analysis:**
                ‚Ä¢ Activity Distribution: {{ state_attr('sensor.sietch_occupancy_distribution', 'activity_distribution') }}
                ‚Ä¢ Primary Zone: {{ states('sensor.sietch_occupancy_distribution') }}
                ‚Ä¢ Time Analysis: {{ state_attr('sensor.motion_pattern_analysis', 'time_analysis') }}
                
                **Efficiency Factors:**
                ‚Ä¢ Expected vs Actual: Performance below anticipated patterns
                ‚Ä¢ Resource Utilization: Movement not optimized for current conditions
                ‚Ä¢ Coordination Issues: Multiple zones active without synergy
                
                üèúÔ∏è "Efficient movement conserves water and energy. Wasted motion is wasted life in the desert."
                
                **Optimization Recommendations:**
                ‚Ä¢ Focus activity in complementary zones
                ‚Ä¢ Coordinate movement with peak efficiency periods
                ‚Ä¢ Reduce simultaneous multi-zone activation
                ‚Ä¢ Consider activity sequencing for better flow
                
                The desert teaches economy of motion. Learn its lessons.
              data:
                actions:
                  - action: "OPTIMIZE_MOVEMENT_PATTERNS"
                    title: "‚ö° Optimize Patterns"
                  - action: "VIEW_MOVEMENT_ANALYTICS"
                    title: "üìä Movement Analytics"
                  - action: "EFFICIENCY_TRAINING"
                    title: "üéØ Efficiency Guide"
                group: "pattern_alerts"
                tag: "pattern_inefficiency"
                notification_icon: "mdi:chart-line-variant"
                color: "#FF9800"
                channel: "Pattern Analysis"
                importance: default
                sticky: false
                timeout: 1200

      # OVERWHELMING ACTIVITY PATTERN
      - conditions:
          - condition: trigger
            id: overwhelming_activity_pattern
        sequence:
          - service: notify.mobile_app_toris_iphone
            data:
              title: "üåä Overwhelming Activity Pattern Alert"
              message: >-
                Full tribal activity overwhelms system response capacity, Duke.
                
                üåä **Activity Status**: {{ states('sensor.motion_pattern_analysis') }} - {{ state_attr('sensor.motion_pattern_analysis', 'pattern_type') }}
                ‚ö° **System Response**: {{ states('sensor.system_response_time') }}% - {{ state_attr('sensor.system_response_time', 'response_grade') }}
                
                **Overwhelming Factors:**
                ‚Ä¢ All zones simultaneously active
                ‚Ä¢ System load: {{ state_attr('sensor.system_response_time', 'current_load') }}
                ‚Ä¢ Response lag detected across multiple systems
                
                **Performance Impact:**
                ‚Ä¢ Harvester Efficiency: {{ states('sensor.harvester_efficiency') }}%
                ‚Ä¢ Automation Response: Delayed due to high load
                ‚Ä¢ Resource Coordination: Strained by concurrent demands
                
                üèúÔ∏è "Even the mightiest sandworm must surface to breathe. Overwhelming activity requires strategic pacing."
                
                **Tactical Recommendations:**
                ‚Ä¢ Implement zone priority sequencing
                ‚Ä¢ Reduce non-essential concurrent activities
                ‚Ä¢ Allow system recovery periods
                ‚Ä¢ Consider staggered activity patterns
                
                Master the rhythm of the desert - intense bursts followed by strategic rest.
              data:
                actions:
                  - action: "IMPLEMENT_ACTIVITY_SEQUENCING"
                    title: "‚è≠Ô∏è Sequence Activities"
                  - action: "REDUCE_CONCURRENT_LOAD"
                    title: "üìâ Reduce Load"
                  - action: "SYSTEM_RECOVERY_MODE"
                    title: "üîÑ Recovery Mode"
                group: "pattern_alerts"
                tag: "overwhelming_activity"
                notification_icon: "mdi:waves"
                color: "#E91E63"
                channel: "Pattern Analysis"
                importance: high
                sticky: false
                timeout: 1800

      # UNUSUAL DORMANCY PATTERN
      - conditions:
          - condition: trigger
            id: unusual_dormancy_pattern
        sequence:
          - service: notify.mobile_app_toris_iphone
            data:
              title: "üò¥ Unusual Dormancy Pattern Detected"
              message: >-
                Extended dormancy during productive hours, Muad'Dib. The sietch sleeps when it should thrive.
                
                üò¥ **Pattern Status**: {{ states('sensor.motion_pattern_analysis') }}
                ‚è∞ **Time Context**: {{ state_attr('sensor.motion_pattern_analysis', 'time_analysis') }}
                
                **Dormancy Analysis:**
                ‚Ä¢ Activity Level: {{ states('sensor.fremen_activity_level') }}% ({{ state_attr('sensor.fremen_activity_level', 'tribal_status') }})
                ‚Ä¢ Primary Zone: {{ states('sensor.sietch_occupancy_distribution') }}
                ‚Ä¢ Expected Period: {{ state_attr('sensor.fremen_activity_level', 'current_period') }}
                
                **Potential Causes:**
                ‚Ä¢ Extended absence from the sietch
                ‚Ä¢ System-wide motion detection issues
                ‚Ä¢ Intentional low-activity period
                ‚Ä¢ Sensor network problems
                
                üèúÔ∏è "The desert does not sleep during the day. Neither should a thriving sietch."
                
                **Investigation Recommendations:**
                ‚Ä¢ Verify presence and intended activity levels
                ‚Ä¢ Check motion sensor network functionality
                ‚Ä¢ Confirm automation system responses
                ‚Ä¢ Consider if intentional conservation mode is active
                
                {% if now().hour >= 12 and now().hour <= 14 %}
                **Midday Note**: Some rest during peak heat is natural, but extended dormancy may indicate issues.
                {% endif %}
                
                Ensure dormancy is by design, not by system failure.
              data:
                actions:
                  - action: "VERIFY_PRESENCE_STATUS"
                    title: "üë§ Verify Presence"
                  - action: "CHECK_MOTION_SENSORS"
                    title: "üì° Check Sensors"
                  - action: "ACTIVATE_SYSTEMS_CHECK"
                    title: "üîç Systems Check"
                group: "pattern_alerts"
                tag: "unusual_dormancy"
                notification_icon: "mdi:sleep"
                color: "#607D8B"
                channel: "Pattern Analysis"
                importance: default
                sticky: false
                timeout: 1200

      # MIDDAY INACTIVITY ANOMALY
      - conditions:
          - condition: trigger
            id: midday_inactivity_anomaly
        sequence:
          - service: notify.mobile_app_toris_iphone
            data:
              title: "‚òÄÔ∏è Midday Inactivity Anomaly"
              message: >-
                Minimal activity during prime productive hours, Duke. The midday sun calls for action.
                
                ‚òÄÔ∏è **Activity Level**: {{ states('sensor.fremen_activity_level') }}% - {{ state_attr('sensor.fremen_activity_level', 'tribal_status') }}
                ‚è∞ **Time Context**: {{ state_attr('sensor.fremen_activity_level', 'current_period') }}
                
                **Midday Expectations vs Reality:**
                ‚Ä¢ Expected: Moderate to high productivity
                ‚Ä¢ Actual: {{ state_attr('sensor.fremen_activity_level', 'tribal_status') }}
                ‚Ä¢ Peak Hours: {{ state_attr('sensor.fremen_activity_level', 'peak_activity_periods') }}
                
                üèúÔ∏è "The midday sun provides energy for work. Wasted daylight is wasted opportunity."
                
                **Possible Considerations:**
                ‚Ä¢ Natural siesta period (culturally appropriate)
                ‚Ä¢ Awaiting optimal conditions for activity
                ‚Ä¢ Conservation of energy for evening productivity
                ‚Ä¢ System or presence verification needed
                
                Balance rest with productivity. The desert rewards both wisdom and action.
              data:
                actions:
                  - action: "MIDDAY_ACTIVITY_SUGGESTIONS"
                    title: "‚òÄÔ∏è Activity Ideas"
                  - action: "VERIFY_MIDDAY_PLAN"
                    title: "üìÖ Verify Plan"
                group: "pattern_alerts"
                tag: "midday_inactivity"
                notification_icon: "mdi:weather-sunny"
                color: "#FFC107"
                channel: "Pattern Analysis"
                importance: default
                sticky: false
                timeout: 900

      # MULTI-ZONE INEFFICIENCY
      - conditions:
          - condition: trigger
            id: multi_zone_inefficiency
        sequence:
          - service: notify.mobile_app_toris_iphone
            data:
              title: "üîÑ Multi-Zone Efficiency Problem"
              message: >-
                Multiple zones active but harvester efficiency suffers, Muad'Dib.
                
                üîÑ **Pattern Type**: {{ state_attr('sensor.motion_pattern_analysis', 'pattern_type') }}
                ‚ö° **Harvester Impact**: {{ states('sensor.harvester_efficiency') }}% ({{ state_attr('sensor.harvester_efficiency', 'efficiency_grade') }})
                
                **Multi-Zone Analysis:**
                ‚Ä¢ Zone Status: {{ state_attr('sensor.sietch_occupancy_distribution', 'zone_status') }}
                ‚Ä¢ Activity Distribution: {{ state_attr('sensor.sietch_occupancy_distribution', 'activity_distribution') }}
                ‚Ä¢ System Load: {{ state_attr('sensor.harvester_efficiency', 'current_load') }}
                
                üèúÔ∏è "Scattered activity dilutes focus. True efficiency comes from coordinated purpose."
                
                **Coordination Strategies:**
                ‚Ä¢ Sequence multi-zone activities for optimal efficiency
                ‚Ä¢ Focus on one primary zone during peak production periods
                ‚Ä¢ Coordinate activities to complement harvester operations
                
                Multiple fronts require a master strategist. Coordinate your movements.
              data:
                actions:
                  - action: "COORDINATE_MULTI_ZONE"
                    title: "üéØ Coordinate Zones"
                  - action: "ZONE_PRIORITY_SEQUENCE"
                    title: "‚è≠Ô∏è Priority Sequence"
                group: "pattern_alerts"
                tag: "multi_zone_inefficiency"
                notification_icon: "mdi:vector-combine"
                color: "#9C27B0"
                channel: "Pattern Analysis"
                importance: default
                sticky: false
                timeout: 1200

      # PHANTOM ACTIVITY PATTERN
      - conditions:
          - condition: trigger
            id: phantom_activity_pattern
        sequence:
          - service: notify.mobile_app_toris_iphone
            data:
              title: "üëª Phantom Activity Pattern Alert"
              message: >-
                Activity detected but no primary zone identified, Duke. Ghost movements in the sietch.
                
                üëª **Anomaly**: Activity without clear zone focus
                üèÉ **Activity Level**: {{ states('sensor.fremen_activity_level') }}%
                üè† **Primary Zone**: {{ states('sensor.sietch_occupancy_distribution') }}
                
                **Phantom Pattern Analysis:**
                ‚Ä¢ Motion sensors detect activity
                ‚Ä¢ No dominant occupancy zone identified
                ‚Ä¢ Possible scattered or brief movements
                ‚Ä¢ Potential sensor calibration issues
                
                üèúÔ∏è "The desert plays tricks on the unwary. Ensure your sensors see truth, not mirages."
                
                **Investigation Steps:**
                ‚Ä¢ Check individual motion sensor status
                ‚Ä¢ Verify sensor calibration settings
                ‚Ä¢ Review recent motion events for patterns
                ‚Ä¢ Consider environmental factors affecting detection
                
                Phantom patterns often reveal sensor issues or very brief activities. Investigate thoroughly.
              data:
                actions:
                  - action: "INVESTIGATE_PHANTOM_ACTIVITY"
                    title: "üîç Investigate Pattern"
                  - action: "CALIBRATE_MOTION_SENSORS"
                    title: "üì° Calibrate Sensors"
                group: "pattern_alerts"
                tag: "phantom_activity"
                notification_icon: "mdi:ghost"
                color: "#795548"
                channel: "Pattern Analysis"
                importance: default
                sticky: false
                timeout: 1200

      # PERFECT MOTION EFFICIENCY ACHIEVEMENT
      - conditions:
          - condition: trigger
            id: perfect_motion_efficiency
        sequence:
          - service: notify.mobile_app_toris_iphone
            data:
              title: "‚≠ê Perfect Motion Efficiency Achieved!"
              message: >-
                Magnificent, Muad'Dib! Your movement patterns achieve perfect efficiency.
                
                ‚≠ê **Perfect Efficiency**: {{ state_attr('sensor.motion_pattern_analysis', 'efficiency_score') }}
                üéØ **Movement Mastery**: {{ states('sensor.motion_pattern_analysis') }} - {{ state_attr('sensor.motion_pattern_analysis', 'pattern_type') }}
                
                **Excellence Metrics:**
                ‚Ä¢ Pattern Coordination: Flawless
                ‚Ä¢ Resource Utilization: Optimal
                ‚Ä¢ Time Synchronization: Perfect
                ‚Ä¢ Energy Conservation: Maximized
                
                **Mastery Benefits:**
                ‚Ä¢ Maximum harvester efficiency alignment
                ‚Ä¢ Optimal system resource utilization
                ‚Ä¢ Perfect automation synchronization
                ‚Ä¢ Exemplary water conservation support
                
                üèúÔ∏è **Desert Master Recognition**: "Your movements flow like the desert wind - purposeful, efficient, and in perfect harmony with the environment."
                
                This level of motion efficiency represents true understanding of desert principles. Every step serves a purpose, every pause conserves energy.
                
                üåü **Fremen Honor**: Motion Efficiency Master
              data:
                actions:
                  - action: "CELEBRATE_MOTION_MASTERY"
                    title: "üéâ Celebrate Mastery"
                  - action: "MOTION_EFFICIENCY_ANALYSIS"
                    title: "üìä Efficiency Report"
                group: "pattern_achievements"
                tag: "perfect_efficiency"
                notification_icon: "mdi:star-circle"
                color: "#4CAF50"
                channel: "Pattern Achievements"
                importance: default
                sticky: false
                timeout: 1200

      # OPTIMAL ACTIVITY-CONSERVATION BALANCE
      - conditions:
          - condition: trigger
            id: optimal_activity_conservation_balance
        sequence:
          - service: notify.mobile_app_toris_iphone
            data:
              title: "‚öñÔ∏è Perfect Activity-Conservation Balance!"
              message: >-
                EXTRAORDINARY ACHIEVEMENT! High activity with excellent conservation - true Fremen mastery!
                
                ‚öñÔ∏è **Perfect Balance Achieved**:
                ‚Ä¢ Activity Level: {{ states('sensor.fremen_activity_level') }}% ({{ state_attr('sensor.fremen_activity_level', 'tribal_status') }})
                ‚Ä¢ Conservation: {{ states('sensor.water_conservation_index') }}% ({{ state_attr('sensor.water_conservation_index', 'conservation_level') }})
                
                **Mastery Demonstration:**
                ‚Ä¢ High tribal activity maintained
                ‚Ä¢ Excellent water conservation achieved simultaneously
                ‚Ä¢ Perfect harmony between movement and efficiency
                ‚Ä¢ Ultimate desert adaptation displayed
                
                üèúÔ∏è **Ultimate Fremen Recognition**: "You have achieved what few can claim - the ability to live fully while wasting nothing. This is the deepest wisdom of Arrakis."
                
                **Balance Master Benefits:**
                ‚ú® Maximum productivity without waste
                üéØ Optimal resource utilization mastery
                üèÜ True desert warrior status
                üåü Perfect adaptation to harsh conditions
                
                This balance is the holy grail of desert living. You embody the Fremen ideal perfectly.
              data:
                actions:
                  - action: "BALANCE_MASTERY_CELEBRATION"
                    title: "üéñÔ∏è Balance Master Ceremony"
                  - action: "FREMEN_WISDOM_SHARING"
                    title: "üìö Share Wisdom"
                group: "ultimate_achievements"
                tag: "perfect_balance"
                notification_icon: "mdi:scale-balance"
                color: "#00BCD4"
                channel: "Ultimate Achievements"
                importance: max
                sticky: true
                timeout: 2400

mode: queued
max: 15
max_exceeded: silent