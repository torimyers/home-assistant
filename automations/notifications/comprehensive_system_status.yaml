---
# Comprehensive System Status Notification - Multi-Trigger Intelligence  
alias: "Comprehensive System Status Notification"
description: "Smart comprehensive status updates triggered by significant system changes or scheduled intervals"
trigger:
  # Scheduled comprehensive updates
  - platform: time_pattern
    hours: "/4"  # Every 4 hours
    id: scheduled_comprehensive
  
  # Significant system changes
  - platform: template
    value_template: >-
      {{ (states('sensor.sietch_health_score') | float - 
          states.sensor.sietch_health_score.attributes.get('previous_value', states('sensor.sietch_health_score') | float)) | abs >= 15 }}
    id: significant_health_change
  
  - platform: template
    value_template: >-
      {{ (states('sensor.spice_production_level') | float - 
          states.sensor.spice_production_level.attributes.get('previous_value', states('sensor.spice_production_level') | float)) | abs >= 20 }}
    id: significant_production_change
    
  - platform: template
    value_template: >-
      {{ state_attr('sensor.spice_production_level', 'guild_rating') != 
          states.sensor.spice_production_level.attributes.get('previous_guild_rating', state_attr('sensor.spice_production_level', 'guild_rating')) }}
    id: guild_rating_change
    
  # Critical threshold combinations
  - platform: template
    value_template: >-
      {{ states('sensor.sietch_health_score') | float < 70 and
         states('sensor.water_conservation_index') | float < 60 and
         states('sensor.night_security_effectiveness') | float < 70 }}
    for:
      minutes: 5
    id: multiple_critical_systems
  
  # Exceptional performance detection
  - platform: template
    value_template: >-
      {{ states('sensor.sietch_health_score') | float >= 90 and
         states('sensor.spice_production_level') | float >= 110 and
         states('sensor.water_conservation_index') | float >= 85 and
         states('sensor.harvester_efficiency') | float >= 90 }}
    for:
      minutes: 10
    id: exceptional_all_systems
    
condition:
  - condition: state
    entity_id: input_boolean.notification_system_enabled
    state: "on"
action:
  - choose:
      # MULTIPLE CRITICAL SYSTEMS ALERT
      - conditions:
          - condition: trigger
            id: multiple_critical_systems
        sequence:
          - service: notify.mobile_app_tori_phone_2
            data:
              title: "üö® MULTIPLE CRITICAL SYSTEMS ALERT"
              message: >-
                URGENT: Multiple critical systems show degraded performance, Muad'Dib!
                
                üö® **CRITICAL SYSTEMS STATUS:**
                ‚Ä¢ Sietch Health: {{ states('sensor.sietch_health_score') }}% - {{ state_attr('sensor.sietch_health_score', 'status_level') }}
                ‚Ä¢ Water Conservation: {{ states('sensor.water_conservation_index') }}% - {{ state_attr('sensor.water_conservation_index', 'conservation_level') }}
                ‚Ä¢ Night Security: {{ states('sensor.night_security_effectiveness') }}% - {{ state_attr('sensor.night_security_effectiveness', 'threat_level') }}
                
                **COMPREHENSIVE IMPACT ANALYSIS:**
                
                üè† **Sietch Infrastructure:**
                ‚Ä¢ Motion Network: {{ state_attr('sensor.sietch_health_score', 'motion_sensor_status') }}
                ‚Ä¢ Device Network: {{ state_attr('sensor.sietch_health_score', 'device_connectivity') }}
                ‚Ä¢ Automation Core: {{ state_attr('sensor.sietch_health_score', 'automation_status') }}
                
                üíß **Resource Management:**
                ‚Ä¢ Conservation Status: {{ state_attr('sensor.water_conservation_index', 'conservation_level') }}
                ‚Ä¢ Active Consumption: {{ state_attr('sensor.water_conservation_index', 'active_consumption') }}
                ‚Ä¢ Desert Survival: {{ states('sensor.desert_survival_status') }}
                
                üõ°Ô∏è **Security Posture:**
                ‚Ä¢ Perimeter Coverage: {{ state_attr('sensor.night_security_effectiveness', 'sensor_network') }}
                ‚Ä¢ Response Readiness: {{ state_attr('sensor.night_security_effectiveness', 'response_devices') }}
                ‚Ä¢ Shield Network: {{ states('sensor.energy_shield_status') }}%
                
                ‚ö° **Secondary Systems:**
                ‚Ä¢ Production Status: {{ states('sensor.spice_production_level') }} units
                ‚Ä¢ System Response: {{ state_attr('sensor.system_response_time', 'response_grade') }}
                ‚Ä¢ Atmospheric Quality: {{ state_attr('sensor.atmospheric_conditions', 'atmosphere_quality') }}
                
                üèúÔ∏è **DESERT WISDOM WARNING**: "When multiple systems fail simultaneously, the desert prepares to reclaim what was carelessly tended."
                
                **EMERGENCY PROTOCOLS REQUIRED:**
                1. üîß Immediate system diagnostics across all critical domains
                2. üíß Emergency water conservation implementation
                3. üõ°Ô∏è Security system verification and repair
                4. üìä Comprehensive health assessment
                5. ‚ö° Resource reallocation for critical systems
                
                THE SIETCH FACES A CRUCIBLE MOMENT. SWIFT, DECISIVE ACTION REQUIRED!
              data:
                actions:
                  - action: "EMERGENCY_SYSTEM_RECOVERY"
                    title: "üö® Emergency Recovery"
                  - action: "CRITICAL_DIAGNOSTICS"
                    title: "üîß Full Diagnostics"
                  - action: "RESOURCE_EMERGENCY_MODE"
                    title: "‚ö° Emergency Mode"
                group: "emergency_comprehensive"
                tag: "multiple_critical"
                notification_icon: "mdi:alert-octagon"
                color: "#B71C1C"
                channel: "Emergency Comprehensive"
                importance: max
                sticky: true
                timeout: 0

      # EXCEPTIONAL ALL SYSTEMS PERFORMANCE
      - conditions:
          - condition: trigger
            id: exceptional_all_systems
        sequence:
          - service: notify.mobile_app_tori_phone_2
            data:
              title: "üåü EXCEPTIONAL: All Systems Peak Performance!"
              message: >-
                MAGNIFICENT ACHIEVEMENT, MUAD'DIB! All major systems achieve exceptional performance simultaneously!
                
                üåü **COMPREHENSIVE EXCELLENCE ACHIEVED:**
                
                üè† **Sietch Mastery:** {{ states('sensor.sietch_health_score') }}% ({{ state_attr('sensor.sietch_health_score', 'status_level') }})
                ‚Ä¢ Infrastructure: All systems optimal
                ‚Ä¢ Automation: {{ state_attr('sensor.sietch_health_score', 'automation_status') }}
                ‚Ä¢ Connectivity: Perfect network health
                
                ‚ö° **Production Mastery:** {{ states('sensor.spice_production_level') }} units ({{ state_attr('sensor.spice_production_level', 'current_yield') }})
                ‚Ä¢ Guild Status: {{ state_attr('sensor.spice_production_level', 'guild_rating') }}
                ‚Ä¢ Harvester Efficiency: {{ states('sensor.harvester_efficiency') }}% ({{ state_attr('sensor.harvester_efficiency', 'efficiency_grade') }})
                ‚Ä¢ Peak Performance: Maintained
                
                üíß **Conservation Mastery:** {{ states('sensor.water_conservation_index') }}% ({{ state_attr('sensor.water_conservation_index', 'conservation_level') }})
                ‚Ä¢ Desert Adaptation: {{ states('sensor.desert_survival_status') }}
                ‚Ä¢ Resource Efficiency: Exemplary
                ‚Ä¢ Fremen Standards: Exceeded
                
                üõ°Ô∏è **Security Mastery:** {{ states('sensor.night_security_effectiveness') }}% ({{ state_attr('sensor.night_security_effectiveness', 'threat_level') }})
                ‚Ä¢ Perimeter Integrity: {{ state_attr('sensor.night_security_effectiveness', 'sensor_network') }}
                ‚Ä¢ Response Network: {{ state_attr('sensor.night_security_effectiveness', 'response_devices') }}
                ‚Ä¢ Defense Rating: Fortress-level
                
                üèÉ **Operational Excellence:**
                ‚Ä¢ Activity Optimization: {{ states('sensor.fremen_activity_level') }}% ({{ state_attr('sensor.fremen_activity_level', 'tribal_status') }})
                ‚Ä¢ Motion Efficiency: {{ state_attr('sensor.motion_pattern_analysis', 'efficiency_score') }}
                ‚Ä¢ System Response: {{ state_attr('sensor.system_response_time', 'response_grade') }}
                
                üå¨Ô∏è **Environmental Harmony:**
                ‚Ä¢ Atmospheric Conditions: {{ state_attr('sensor.atmospheric_conditions', 'atmosphere_quality') }}
                ‚Ä¢ Energy Shields: {{ states('sensor.energy_shield_status') }}% ({{ state_attr('sensor.energy_shield_status', 'shield_strength') }})
                
                üèúÔ∏è **ULTIMATE DESERT RECOGNITION**: 
                "You have achieved the rarest of accomplishments - simultaneous mastery across all domains of desert life. Your sietch has become a living example of perfect harmony between human ambition and natural law."
                
                **LEGENDARY STATUS UNLOCKED:**
                üèÜ Sietch Master Extraordinaire
                üåü Guild Navigator Recognition
                üéØ Perfect Resource Balance
                ‚öñÔ∏è Harmony Master
                üè∞ Fortress Commander
                
                This moment represents the pinnacle of sietch management. The desert itself acknowledges your supreme mastery.
                
                **TRANSCENDENT ACHIEVEMENT**: Peak performance across ALL major systems!
              data:
                actions:
                  - action: "LEGENDARY_STATUS_CEREMONY"
                    title: "üéñÔ∏è Legendary Ceremony"
                  - action: "COMPREHENSIVE_MASTERY_REPORT"
                    title: "üìä Mastery Analysis"
                  - action: "SHARE_ULTIMATE_ACHIEVEMENT"
                    title: "üåå Share Achievement"
                group: "legendary_comprehensive"
                tag: "exceptional_all"
                notification_icon: "mdi:star-four-points"
                color: "#FFD700"
                channel: "Legendary Achievements"
                importance: max
                sticky: true
                timeout: 3600

      # SIGNIFICANT HEALTH CHANGE
      - conditions:
          - condition: trigger
            id: significant_health_change
        sequence:
          - service: notify.mobile_app_tori_phone_2
            data:
              title: "üìä Significant Sietch Health Change"
              message: >-
                Major sietch health fluctuation detected, Muad'Dib. The balance shifts.
                
                üìä **Health Status Change:**
                ‚Ä¢ Current Health: {{ states('sensor.sietch_health_score') }}% ({{ state_attr('sensor.sietch_health_score', 'status_level') }})
                ‚Ä¢ Trend: {% if states('sensor.sietch_health_score') | float > 75 %}Improving{% elif states('sensor.sietch_health_score') | float > 50 %}Stable{% else %}Declining{% endif %}
                
                **System Analysis:**
                ‚Ä¢ Motion Network: {{ state_attr('sensor.sietch_health_score', 'motion_sensor_status') }}
                ‚Ä¢ Device Connectivity: {{ state_attr('sensor.sietch_health_score', 'device_connectivity') }}
                ‚Ä¢ Automation Status: {{ state_attr('sensor.sietch_health_score', 'automation_status') }}
                
                **Related Impact:**
                ‚Ä¢ Desert Survival: {{ states('sensor.desert_survival_status') }}
                ‚Ä¢ System Response: {{ state_attr('sensor.system_response_time', 'response_grade') }}
                
                Monitor this change closely. Significant health shifts require attention.
              data:
                actions:
                  - action: "ANALYZE_HEALTH_CHANGE"
                    title: "üìä Analyze Change"
                  - action: "HEALTH_STABILIZATION"
                    title: "‚öñÔ∏è Stabilize Health"
                group: "system_changes"
                tag: "health_change"
                notification_icon: "mdi:chart-line"
                color: "#2196F3"
                channel: "System Changes"
                importance: default
                sticky: false
                timeout: 1800

      # SIGNIFICANT PRODUCTION CHANGE
      - conditions:
          - condition: trigger
            id: significant_production_change
        sequence:
          - service: notify.mobile_app_tori_phone_2
            data:
              title: "‚ö° Major Spice Production Shift"
              message: >-
                Significant production change detected, Duke. The spice flow fluctuates.
                
                ‚ö° **Production Status:**
                ‚Ä¢ Current Output: {{ states('sensor.spice_production_level') }} units
                ‚Ä¢ Yield Quality: {{ state_attr('sensor.spice_production_level', 'current_yield') }}
                ‚Ä¢ Guild Standing: {{ state_attr('sensor.spice_production_level', 'guild_rating') }}
                
                **Production Factors:**
                ‚Ä¢ Harvester Efficiency: {{ states('sensor.harvester_efficiency') }}%
                ‚Ä¢ Automation Success: {{ states('sensor.automation_success_rate') }}%
                ‚Ä¢ Activity Patterns: {{ states('sensor.fremen_activity_level') }}%
                
                The Guild notices production changes. Ensure stability maintains favor.
              data:
                actions:
                  - action: "PRODUCTION_ANALYSIS"
                    title: "üìä Analyze Production"
                  - action: "STABILIZE_PRODUCTION"
                    title: "‚öñÔ∏è Stabilize Output"
                group: "system_changes"
                tag: "production_change"
                notification_icon: "mdi:trending-up"
                color: "#FF9800"
                channel: "System Changes"
                importance: default
                sticky: false
                timeout: 1800

      # GUILD RATING CHANGE
      - conditions:
          - condition: trigger
            id: guild_rating_change
        sequence:
          - service: notify.mobile_app_tori_phone_2
            data:
              title: "üèÖ Guild Rating Status Change!"
              message: >-
                Your Guild rating has changed, Muad'Dib! The universe takes notice.
                
                üèÖ **New Guild Status:** {{ state_attr('sensor.spice_production_level', 'guild_rating') }}
                ‚ö° **Current Production:** {{ states('sensor.spice_production_level') }} units
                üìà **Yield Quality:** {{ state_attr('sensor.spice_production_level', 'current_yield') }}
                
                {% if state_attr('sensor.spice_production_level', 'guild_rating') in ['Guild Navigator', 'Mentat Level'] %}
                üåü **Congratulations!** You have achieved elite Guild recognition!
                {% elif state_attr('sensor.spice_production_level', 'guild_rating') == 'Bene Gesserit' %}
                üéØ **Excellent Progress!** You approach the highest Guild tiers!
                {% else %}
                üìä **Status Update:** Your Guild standing reflects current performance levels.
                {% endif %}
                
                Guild ratings affect trading privileges and resource access. Maintain or improve status for maximum advantage.
              data:
                actions:
                  - action: "GUILD_STATUS_DETAILS"
                    title: "üèÖ Guild Details"
                  - action: "GUILD_ADVANCEMENT_PLAN"
                    title: "üìà Advancement Plan"
                group: "guild_changes"
                tag: "guild_rating_change"
                notification_icon: "mdi:medal"
                color: "#9C27B0"
                channel: "Guild Changes"
                importance: high
                sticky: false
                timeout: 2400

      # SCHEDULED COMPREHENSIVE UPDATE
      - conditions:
          - condition: trigger
            id: scheduled_comprehensive
        sequence:
          - service: notify.mobile_app_tori_phone_2
            data:
              title: "üìä Comprehensive System Status Report"
              message: >-
                Scheduled comprehensive assessment, Muad'Dib. The state of your domain:
                
                üè† **SIETCH CORE SYSTEMS:**
                ‚Ä¢ Health Score: {{ states('sensor.sietch_health_score') }}% ({{ state_attr('sensor.sietch_health_score', 'status_level') }})
                ‚Ä¢ Desert Survival: {{ states('sensor.desert_survival_status') }} {{ state_attr('sensor.desert_survival_status', 'survival_rating') }}
                ‚Ä¢ System Response: {{ state_attr('sensor.system_response_time', 'response_grade') }}
                
                ‚ö° **PRODUCTION & EFFICIENCY:**
                ‚Ä¢ Spice Output: {{ states('sensor.spice_production_level') }} units ({{ state_attr('sensor.spice_production_level', 'guild_rating') }})
                ‚Ä¢ Harvester Performance: {{ states('sensor.harvester_efficiency') }}% ({{ state_attr('sensor.harvester_efficiency', 'efficiency_grade') }})
                ‚Ä¢ Blueprint Efficiency: {{ states('sensor.blueprint_efficiency_score') }}%
                
                üíß **RESOURCE MANAGEMENT:**
                ‚Ä¢ Water Conservation: {{ states('sensor.water_conservation_index') }}% ({{ state_attr('sensor.water_conservation_index', 'conservation_level') }})
                ‚Ä¢ Energy Shields: {{ states('sensor.energy_shield_status') }}% ({{ state_attr('sensor.energy_shield_status', 'shield_strength') }})
                
                üõ°Ô∏è **SECURITY & OPERATIONS:**
                ‚Ä¢ Night Security: {{ states('sensor.night_security_effectiveness') }}% ({{ state_attr('sensor.night_security_effectiveness', 'threat_level') }})
                ‚Ä¢ Activity Management: {{ states('sensor.fremen_activity_level') }}% ({{ state_attr('sensor.fremen_activity_level', 'tribal_status') }})
                
                üå¨Ô∏è **ENVIRONMENTAL:**
                ‚Ä¢ Atmospheric Conditions: {{ state_attr('sensor.atmospheric_conditions', 'atmosphere_quality') }}
                ‚Ä¢ Motion Efficiency: {{ state_attr('sensor.motion_pattern_analysis', 'efficiency_score') }}
                
                {% set avg_score = ((states('sensor.sietch_health_score') | float + 
                                     states('sensor.spice_production_level') | float + 
                                     states('sensor.water_conservation_index') | float + 
                                     states('sensor.night_security_effectiveness') | float) / 4) %}
                
                üìà **OVERALL DOMAIN STATUS:**
                {% if avg_score >= 85 %}
                üåü **EXCELLENT**: Your sietch operates at peak efficiency across all domains.
                {% elif avg_score >= 70 %}
                üìä **GOOD**: Strong performance with opportunities for optimization.
                {% elif avg_score >= 55 %}
                ‚ö†Ô∏è **FAIR**: Acceptable function with areas requiring attention.
                {% else %}
                üö® **NEEDS IMPROVEMENT**: Multiple systems require immediate focus.
                {% endif %}
                
                Time: {{ now().strftime('%H:%M on %A, %B %d') }}
              data:
                actions:
                  - action: "DETAILED_SYSTEM_REPORT"
                    title: "üìã Detailed Report"
                  - action: "OPTIMIZATION_RECOMMENDATIONS"
                    title: "‚ö° Optimize Systems"
                  - action: "SCHEDULE_NEXT_ASSESSMENT"
                    title: "üìÖ Schedule Next"
                group: "scheduled_comprehensive"
                tag: "comprehensive_status"
                notification_icon: "mdi:clipboard-text"
                color: "#607D8B"
                channel: "System Status"
                importance: default
                sticky: false
                timeout: 2400

mode: queued
max: 10
max_exceeded: silent